#define DUCKDB_EXTENSION_MAIN

#include "quackml_extension.hpp"
#include "duckdb.hpp"
#include "duckdb/common/exception.hpp"
#include "duckdb/common/string_util.hpp"
#include "duckdb/function/scalar_function.hpp"
#include "duckdb/main/extension_util.hpp"
#include <duckdb/parser/parsed_data/create_scalar_function_info.hpp>

#include "functions/sum.hpp"
#include "functions/sum_count.hpp"
#include "functions/linear_reg.hpp"
#include "functions/to_ring.hpp"
#include "functions/linear_reg_ring.hpp"
#include "types/linear_reg_ring.hpp"

// OpenSSL linked through vcpkg
#include <openssl/opensslv.h>

#include <iostream>

namespace duckdb {

void run_quackml_tests(DuckDB &db) {
    std::cout << "<=========== Running QuackML tests ===========>\n";

    Connection con(db);

    // MUNGO TODO: Linear regression tests 
    con.Query("CREATE TABLE t (features DOUBLE[], label DOUBLE);");
    con.Query("INSERT INTO t VALUES ([-0.41908129408103095, 0.6000631187108824, 0.020872561940038344, -0.8579354300550468, -0.9486520342617163, 2.066368692223482, -0.8343033519442244, 1.453681029625907, 0.7482088958224327], 8.545464621421077);");
    con.Query("INSERT INTO t VALUES ([-0.2637027740107017, -1.0506341966417876, 1.7490334770414018, 0.5330074557476814, -0.044524468868854854, -0.6411624957715726, 0.8395139405074226, 0.46679460831238556, -1.979627074056139], 22.232460029686983);");
    con.Query("INSERT INTO t VALUES ([-1.5764998315135228, -0.22476379513096395, 0.9085925143255978, -0.825551816349784, -0.20910384266237422, -0.5099664759046616, -1.8087544655544108, -1.1612653522032774, 0.6912278070777729], 1.304445827550742);");
    con.Query("INSERT INTO t VALUES ([-2.5484039799965954, -0.3253692510221873, 0.7140446348865763, 1.0706808969119048, -0.7622945753020206, -0.11949876617996712, -0.7695663688911851, 0.20296598657624737, 0.6076794770509469], -14.707459469965997);");
    con.Query("INSERT INTO t VALUES ([-0.21278417458921256, -0.01706704549317923, -0.37111067189169555, -0.09867617967309475, -1.3726055687297254, -0.47219998314315825, 0.9218542049741767, -2.024781112069217, 1.1050824950647038], -22.774219820343596);");
    con.Query("INSERT INTO t VALUES ([0.4141507183701145, 0.21119349472941099, -0.6101131339645629, -1.2019231350463517, 1.0539345006293823, 0.34181222732822625, 1.7359604626739358, 0.6868229182368646, 0.46695023586979467], 25.9215838549921);");
    con.Query("INSERT INTO t VALUES ([-0.6739887679251497, -0.09879499738469076, -1.914091697861407, 0.6990691501343953, -1.3025036549758482, -0.796956843427341, 0.4870552703241278, 0.38569445841128414, 0.8412839838111056], -22.87073366673594);");
    con.Query("INSERT INTO t VALUES ([-0.3363749695111863, 1.5147644788311643, 0.5225173443277908, 0.47285743399966024, 1.7891367755799636, 1.2261956833751686, 0.2805777007877379, 0.09121855043761884, -0.30375780342373127], 20.571864472019588);");
    con.Query("INSERT INTO t VALUES ([-0.8524017400050005, -0.1762840701460891, -0.4197782686399172, -0.05533502945311833, 1.7005598082617772, -0.40029174411401186, -1.0106285650067297, -0.12734729249030108, -1.0049541247277634], 22.85171077277175);");
    con.Query("INSERT INTO t VALUES ([-0.7449786651020911, 0.5136862544590622, 0.07280760958918009, -0.9960785283392678, -0.6434513863449461, -1.0532333900958788, -0.5597649237972336, 0.33024335981912195, -0.23013252050004782], 7.95513369524192);");
    con.Query("INSERT INTO t VALUES ([0.5195804357008078, 0.0254085055441908, -0.3635548386466328, 1.8022997403714158, 0.09721609941439727, 0.20048913689068804, 0.46937701927262415, 0.3118201718066563, 1.1327138076577425], -10.393727129178984);");
    con.Query("INSERT INTO t VALUES ([-0.5425468657199428, -0.43193101320941435, -0.9169762126930999, 1.142691304055167, 0.30922684301543707, 1.0378564969743604, 2.247668335078236, -3.0847720955212843, -0.16989192841476], -17.326716605374063);");
    con.Query("INSERT INTO t VALUES ([-0.9192602839317378, -0.5135374965321492, -0.10518609930722908, 0.06193664224401734, -1.9325049277388655, -0.09354402001912104, 0.8578237935432114, 0.09232120422035793, -0.7286219096483609], -9.028316194237284);");
    con.Query("INSERT INTO t VALUES ([-0.2948424190750096, 2.3497064230051956, -0.5185742600685768, 2.3402764336350184, 2.239167205677224, -0.8479464688023, -0.38860214655507136, -0.7598835466257688, -0.4663038335646501], -1.5437887956027545);");
    con.Query("INSERT INTO t VALUES ([2.064857021826057, -1.0147753535689705, 0.7988471623138377, 0.735662729167828, -0.051107376061118925, 0.45007444025615145, -0.18470544354224708, -1.7631365302813633, 2.111935457256043], -6.851043293452115);");
    con.Query("INSERT INTO t VALUES ([-0.15126207939037367, 1.6744874344240248, -0.31563130609032186, -0.6937373639515946, -2.7692504269465625, -0.04531150595616479, -2.060580097327278, 1.2264908293008119, -1.291643379568489], -4.8932817238964255);");
    con.Query("INSERT INTO t VALUES ([0.4727373825442501, 1.152869805679854, 0.9733273441287303, -1.898189951372953, 0.24724600245404274, 0.043622013193168226, 1.4219764581844494, -2.000996475834512, 0.25421805817295534], 16.1840648890138);");
    con.Query("INSERT INTO t VALUES ([-0.30154788729232207, 1.1354713423785423, 0.5383808837758295, 2.4405981877456555, -0.19745096163369744, -0.5900898768339194, -0.654256714158988, -1.565299531344717, 1.133681671461872], -29.408902859066117);");
    con.Query("INSERT INTO t VALUES ([1.9125580504954809, 1.484308013363865, 0.9460544603144407, 0.8590969240369231, 0.399685102930243, -1.1817688416706147, 0.15039571997842568, -0.391521301982967, 0.8359472176599376], 2.958555060208141);");
    con.Query("INSERT INTO t VALUES ([-0.509870886201485, 0.634817761555159, -0.4223193925516161, 1.3351883101919286, -0.26065063545404227, 0.916776395699824, 0.9533835732559568, -1.2919644599310995, 1.0414968806721066], -21.26641825985925);");
    con.Query("INSERT INTO t VALUES ([-0.24711497999395463, 0.7231525522411169, -1.577606521982637, -1.628826888722801, -0.971068468771088, -0.3643939110634407, 0.8655749694366133, -1.6905087053556391, 1.345535373782108], -12.751691548304208);");
    con.Query("INSERT INTO t VALUES ([0.8178002494120298, 0.141236679364179, -0.9068873160586403, -0.8673798472417452, 0.03215937080241466, 0.7039933178908188, 0.5059651344391403, -0.8314612349081253, -0.2877629513461369], 10.757353140509741);");
    con.Query("INSERT INTO t VALUES ([-1.7683516360354632, -0.30423499840601903, -0.7878876135864079, 0.11885733858706635, -0.18045653858049082, -0.9138867344910183, -1.0352762658544217, 0.1279346766309283, -0.7375615850618812], -0.009508347587905419);");
    con.Query("INSERT INTO t VALUES ([-0.357917356666143, 0.2402287849375654, -0.14921930601435804, 0.7936850585582792, 2.009339685239421, 0.6670987928269161, 0.5850364628091151, 0.4555978879728518, 1.1326475701361094], 13.865340216768193);");
    con.Query("INSERT INTO t VALUES ([-1.0735513821899236, 1.7706527410533228, -1.3439004477155465, 0.010365208339044096, 0.6613756670531652, 0.16806477175405887, -1.1172399131971513, 1.487096519278078, -0.5221918720569926], 10.946404645656942);");
    con.Query("INSERT INTO t VALUES ([0.4608178035115987, 0.12257996887614428, 0.15946390598318227, 0.5492428828182084, -0.9417772103288607, -0.8594083244729444, -0.0021958600610675087, 0.04470676397129224, 0.10314443464276687], -5.246385536620496);");
    con.Query("INSERT INTO t VALUES ([1.5662878134533589, -0.18420344834870164, -0.5132830024666413, 1.7567137840788842, 0.5844864923916846, 0.21993084668012944, 0.15742771511414863, 0.7791644061128449, 0.23761986908846933], 4.14846001788701);");
    con.Query("INSERT INTO t VALUES ([-0.27710859938055005, 0.8273116145647733, -0.2926001556483546, -0.1294015747048497, 1.2094115078358243, 0.12555385491881446, 0.7973714460353757, 0.49831889041919486, -2.076368156827749], 28.262555609450136);");
    con.Query("INSERT INTO t VALUES ([-1.2403565153460159, 0.29225349996416017, 0.8893231730595421, -1.3560197733814197, -0.8606001195658365, 1.4787547819507456, -0.042449546226654755, 1.4236454665519696, 0.14833391258706455], 17.2097858090059);");
    con.Query("INSERT INTO t VALUES ([-0.21220257985819052, -0.2736968186750918, 0.19327784302163653, -0.19982839593622034, 0.15828910207892935, 0.46888367767667233, 0.02609387674258732, 1.0824653112134364, 0.16062379352408404], 15.78521762218572);");
    con.Query("INSERT INTO t VALUES ([0.9520843176666731, 0.34176114935947227, 0.33306506429353416, -0.7886851335879116, -0.010315386343796987, 0.8225237186371532, -1.5174149804507049, -0.1838025099521074, -0.38177236324110253], 18.53400648814646);");
    con.Query("INSERT INTO t VALUES ([1.16304839788019, 1.9833616358248451, -0.4619257697708921, 0.5075699275232608, -1.2747409734756059, -0.09555284084038451, -0.6968885392623118, -0.41168749419825873, 0.7668210915261543], -16.846605108021677);");
    con.Query("INSERT INTO t VALUES ([-0.5471756517240909, 0.5755222348863118, 1.3851159808467395, -0.71383916700695, 1.10337467679328, 0.38740493967775574, -0.13666359646189688, -0.08099847736806803, -0.3265315694716736], 27.00404832583296);");
    con.Query("INSERT INTO t VALUES ([0.0640251421737434, 1.1279303538969012, 0.2558360762656282, -0.9447385188286036, 0.5244282755178221, -1.1725298030006028, -0.934048399087705, 0.5429609912496488, 0.8475850211403432], 15.541671701625091);");
    con.Query("INSERT INTO t VALUES ([0.06352339042397713, 0.21073525872938706, -0.5427834163542906, -1.0094307621232967, 1.2742764109827014, -0.33189767552332644, 0.9437492220887761, 0.9407051780111612, -1.43977990134089], 35.71242750546361);");
    con.Query("INSERT INTO t VALUES ([-2.7330991109095017, 0.6258965461498255, -0.5513835920181605, 1.4227989100301697, 1.367423545474494, -1.6447343061354878, 0.4990702418118204, 0.7895297151312085, -2.5108132329884945], 11.124776270391317);");
    con.Query("INSERT INTO t VALUES ([0.10350983380720064, -0.717219871665121, 2.1366272787187217, -0.1752670290355276, 0.33471786674349857, -0.14881638549985307, -1.0255523669155553, -0.7623968055978289, 0.7466015874801913], 14.012267041712484);");
    con.Query("INSERT INTO t VALUES ([0.1852425871935741, -0.09944063239446688, 0.006741028377239998, 0.1746591221329895, 0.21107441946109043, -0.2456613755212663, -0.6227072381513805, 0.33972563299636527, 0.608467031484862], 6.6946015700007635);");
    con.Query("INSERT INTO t VALUES ([0.6718288143014707, -2.940995807250851, -0.26996734895067104, 0.3986951585337829, 1.4086888577334007, -1.6205783324806313, -2.562720855912441, 0.33136696137834715, 0.797260343313239], 19.35620187077868);");
    con.Query("INSERT INTO t VALUES ([-1.9217368352530324, 3.133334212501181, -0.9677324699307908, -0.8324009284464117, -0.6163604187376975, 0.6628666663563009, -1.0871148771019317, -0.751325759027656, 1.421526645256782], -17.992240506618494);");
    con.Query("INSERT INTO t VALUES ([0.6684777597046768, 0.5497864846024791, -1.0536123152892167, -0.0728555227107273, -1.041325428236785, 0.557570165803927, -1.2534845938544128, -1.4885703478345582, 0.9492833570068873], -16.729371982096342);");
    con.Query("INSERT INTO t VALUES ([-0.4745939058063061, 1.4263824789184636, -1.6949870827516713, -0.5006726538596638, -0.061525283990489246, -0.5046686798499213, -0.6188550122673634, 0.9557014571802427, -0.3141183619483096], 5.239589084493217);");
    con.Query("INSERT INTO t VALUES ([0.46601975991689026, -0.558502467892675, -0.09544411877683648, 0.5360386435571273, 1.7110582494355269, 2.139067062284192, 1.4046660551937784, -0.7384773123463582, 0.7076274695266197], 15.153045989810701);");
    con.Query("INSERT INTO t VALUES ([0.26706887304746746, 0.16120661968811112, -0.09957497720302508, -0.8835078654053411, -0.22649754542025766, -0.18634331940562113, 0.5465067025455875, 0.4854066037591633, 1.350706183003082], 7.597237269789275);");
    con.Query("INSERT INTO t VALUES ([-0.6916188638384576, 1.1720979129206937, -1.0368150104278078, -0.6578186200269871, 1.0294643784107738, 0.6706985582494612, -1.6659263780806477, 1.0717589324949965, -1.1295757759056038], 24.638788007097332);");
    con.Query("INSERT INTO t VALUES ([-0.029020611063311056, 2.115688412177631, 0.5467103059488657, 0.2369225649518602, 1.7911129724369501, -0.00942726402170091, 0.4456787151625446, 0.039512132768091734, 1.821572147123683], 10.173311462768279);");
    con.Query("INSERT INTO t VALUES ([0.3384176797560729, -0.21603421118209232, 0.5519846292679305, -0.6562619588380663, -0.8695536689996315, -0.44735673902696477, -0.5607394774817253, 0.7119926734982851, 0.21123252363670353], 10.135816638692914);");
    con.Query("INSERT INTO t VALUES ([1.404320888884549, 0.28882236874824846, -0.04233327690218207, 0.6343273375059132, 0.6216176615239041, -0.13211679136409094, -0.6825012334788461, -0.9832155267345387, 0.6500135856048185], 2.687662722155376);");
    con.Query("INSERT INTO t VALUES ([-0.06585361878667906, 0.6599790559717761, 1.4466607240574254, -0.8505377174063515, -0.5955625731032866, -0.14972267108829485, -1.2707425098718883, -0.5433113729299296, 0.19192714945306474], 8.887447226244078);");
    con.Query("INSERT INTO t VALUES ([-0.6609979597800639, -0.18857331915788056, 1.0840024346656822, 2.165636346071323, 1.9259278886618025, 1.1605298491685776, -0.24954870928108885, -0.301811891168347, 0.8134018268520297], 5.322883986090634);");
    con.Query("INSERT INTO t VALUES ([-0.16221068711671802, -1.141686219872143, 1.6334838575925088, 0.8197618871494678, 1.0932806634009742, 0.3371403268182884, 0.30677524515939053, -1.4969912934545022, 0.2774492586542981], 10.077044248451479);");
    con.Query("INSERT INTO t VALUES ([0.2929112046727582, 1.6390486982268835, -0.4918492953480364, -1.8808973048439155, -0.27813270629576015, 0.3609484742243595, 0.5886955182463581, -0.7141702988813463, 1.1616828308477447], 6.15890594384075);");
    con.Query("INSERT INTO t VALUES ([-0.018200519028544675, -0.7109381538400515, -0.9083454870146904, -1.0238103092723383, 1.6469452554043655, 1.7438121701235019, 1.88233347965342, 1.1099350357506161, -0.42113799055142054], 37.14605987698739);");
    con.Query("INSERT INTO t VALUES ([0.7583783285177148, 1.108956761011123, 0.6264200726195562, 1.5785308994412384, -1.4147112973514544, 0.023365365831572227, 0.3331711239961315, 0.5109551564275255, -1.7232006270111484], -4.603602834658929);");
    con.Query("INSERT INTO t VALUES ([0.42063897873668543, -0.2387634054252513, 1.0550619417881713, 0.2244240343160407, -0.3817826557315198, -0.22920501644435728, 1.2435484286828453, 0.2372830538908849, -1.4954568480035049], 16.16274983112883);");
    con.Query("INSERT INTO t VALUES ([1.8456980150144757, 1.2486953828925047, -0.39511504746630816, -1.9194216612969184, -0.8155307957670026, 0.3746744395720437, -0.14371702014229515, -0.06538524573448273, -1.2347444001198913], 22.696309429364597);");
    con.Query("INSERT INTO t VALUES ([1.4748850148232566, -0.35192531016742884, -0.061197562312257835, 0.7947282355944376, -0.7589190955833377, -2.7919259844605304, -0.7698554025247619, 0.6381741349884288, 0.9927740518491851], -5.869307898214256);");
    con.Query("INSERT INTO t VALUES ([0.2648524854567146, 1.4968009739096615, -0.419097346031304, -0.5490399365351419, 0.9670343460543986, 0.490922414790986, 0.6852323197520938, 1.6921872181361528, 0.839308899131672], 20.97550874100972);");
    con.Query("INSERT INTO t VALUES ([0.07425261764144672, 0.5470271645008918, -1.5942616584066875, -0.490283915920211, -0.268090799907047, -0.026771374000273417, 0.3457538416619747, 0.3433593223236454, 0.6028671879000984], -0.06319968338846671);");
    con.Query("INSERT INTO t VALUES ([1.5658788938407635, -0.32154564206603936, 0.3269347417160397, -0.02044711099050247, -1.4448281617918033, 0.8111952340642531, -1.182722347606717, -0.04341494784545178, 0.871250927018831], -2.953543775940844);");
    con.Query("INSERT INTO t VALUES ([-0.2919016319619632, -0.20618010299248812, 0.6794523914195386, -1.4730023556149365, 0.15386071516721783, 1.1984527969274015, -0.4933648506012761, -0.471223292677896, 0.6665312609371948], 17.93291018605364);");
    con.Query("INSERT INTO t VALUES ([1.1712093616798687, 0.7956901782894221, -1.597253120409136, 0.050708446528067094, -0.5620278917878426, 0.9632646349058277, -0.3178526986053043, -0.58507625281385, -1.380891562748437], 2.0116578330878614);");
    con.Query("INSERT INTO t VALUES ([0.651455956171273, -0.23311810731448804, -0.7385786142528686, -0.9564322687336257, 0.8458154256826901, -0.4075036152888498, 1.1497793451750207, -0.3036813993919807, 1.1107483164221863], 14.250434412784852);");
    con.Query("INSERT INTO t VALUES ([0.8289174614388248, 0.849178330152339, -0.8940217532694265, 0.11643706570174116, -0.4866909463459633, 0.1016807029227308, 1.3996470779560761, -0.4201965416906072, 0.6357969295292165], -6.277692984969896);");
    con.Query("INSERT INTO t VALUES ([-1.4218733630694607, 0.17682612809572854, -0.26922073009181213, 1.1937608435653546, -1.4525625316684918, -0.6518115341424667, 0.08164284814036044, 0.7779375835018595, -0.49455659485731973], -15.608645441652921);");
    con.Query("INSERT INTO t VALUES ([0.8446418259076802, 0.1897418811883568, -0.02106631844288391, 0.4928299387873648, 0.3002457771199079, 0.034564399167124955, -0.7988495081252412, -0.24765291288837823, 1.0949173002744021], 1.1514622587082668);");
    con.Query("INSERT INTO t VALUES ([0.18022379197064325, -1.2854162597088732, -0.14836420961836938, 0.10135713294845634, 0.6320352740053011, 0.9990260192299921, -1.592372245804059, -0.962281281396033, -0.021044060694005235], 10.688347375036113);");
    con.Query("INSERT INTO t VALUES ([-1.8300083875821362, -0.20146576190015292, 0.5352615152065021, 0.3506117108094707, 0.3352869731378824, 0.4375634006278008, -0.30676154010912604, -1.5271617163018936, 0.1573323871858324], -3.718265623165747);");
    con.Query("INSERT INTO t VALUES ([-1.6539287231579882, 0.049761708644441204, -0.6550009926364653, 0.546581144142758, 1.1593933331661628, -0.43311972473458826, -0.3206309956581111, -0.5072349495682145, -0.735437103376259], 6.088468332350327);");
    con.Query("INSERT INTO t VALUES ([0.05789982615793487, -0.01347113318784453, -1.1747028281071774, 0.37013919966858755, 1.2255101247931255, -0.1139754996452315, -1.561371036566006, -0.6496447986198187, 1.1566950785522119], 1.424633072704828);");
    con.Query("INSERT INTO t VALUES ([-0.2463699541017394, -1.6662215228798531, 0.8509316770314158, 0.3579052528973945, -0.179750565115867, 0.78593076206526, 0.3183454946658299, 0.4715152714626204, -1.0184361578769825], 16.751750691121465);");
    con.Query("INSERT INTO t VALUES ([-0.11773237582191508, 0.0709790620787645, -0.4206842710135283, 0.7295765962017262, 0.12622842082055472, 0.23767414977965756, -0.9243373207116, 0.19625643737609347, -0.4773323511804186], 3.7271687746560147);");
    con.Query("INSERT INTO t VALUES ([-0.1164787773838681, 1.2161140721403347, -0.1378311247387826, 0.6808441599316192, -0.515495329063389, 1.845224906319261, -0.9928796111385028, 1.841544089504398, 0.7041462659679137], 1.1130138075908231);");
    con.Query("INSERT INTO t VALUES ([0.4516579112398999, 0.2854732155902301, -0.19231206684035762, -0.3515417721737306, -0.4105125402731767, 2.1747484445514025, 0.8022828570775595, 1.6080569596892051, -1.2371822969742032], 22.533445077977508);");
    con.Query("INSERT INTO t VALUES ([1.4994166572236673, 1.2386509377279766, -0.48298611236962696, 0.2004284251729172, -0.6173178812496912, 0.6904155093430835, 0.23033091561409588, -0.9468502633397944, -0.6741623602107281], -0.7433086921962664);");
    con.Query("INSERT INTO t VALUES ([-0.1783796132454557, 0.3540417181374411, 1.0762712690943401, -1.5191789064689318, 0.1049932057179339, -0.23671271223803259, 1.2923916022706288, -1.5062003814831595, 1.5532695595083226], 7.626170486383529);");
    con.Query("INSERT INTO t VALUES ([0.7804796617545547, -0.45804152121066954, 0.05518120423615744, 0.7427523412015928, 1.2789090310235687, -0.376327777079129, -0.32203012934104325, -0.07612647864454562, -0.377546642381084], 17.17718243583257);");
    con.Query("INSERT INTO t VALUES ([-0.6364690156471334, 0.2643923666244804, 1.7631183718343835, -0.45173356496907335, 1.5312062797863442, -2.0175248599370144, 1.9599766878335103, -0.8138050284133986, 0.5127700539419016], 20.358606473263343);");
    con.Query("INSERT INTO t VALUES ([1.4407186474777063, -2.39884809575713, -2.8268796208301876, 0.5345228304144027, 0.520044980017475, -0.12524512396399692, -0.21595988226992324, -0.32323529366600073, -1.0949356212343484], 8.949812341346423);");
    con.Query("INSERT INTO t VALUES ([-0.2875042780087522, -1.3379405949083527, -0.8559839807229168, 1.1522924184787866, 0.14953414076320495, 1.4805244131884754, 0.21446931385924792, 0.35233555007251566, 0.3563559891886388], -1.0226774304548094);");
    con.Query("INSERT INTO t VALUES ([-0.5041165802310845, 0.5603718768169602, -0.569602305558129, -0.33496152358076403, -0.5319867630004363, -1.033778793599085, 1.8346372654129384, 0.6852198164341929, 0.7321681114617645], -1.2882116636544474);");
    con.Query("INSERT INTO t VALUES ([-1.139390494823559, -0.1806134443154735, 0.8947831625612164, 0.03751620529169532, -0.3700783470297126, -1.4207382649588327, -1.7683834145801807, 0.35695632391564897, -0.34836532906763057], 5.997223288761725);");
    con.Query("INSERT INTO t VALUES ([0.48214063235271454, -1.4350162470394843, 1.369442464241798, -0.42974780142303637, -1.6096635456336499, 1.2704725082736192, 0.31576391272901266, 0.17133120218572193, 0.9393263606973428], 3.1757314645012595);");
    con.Query("INSERT INTO t VALUES ([0.355077684039179, 0.7695756942188713, 0.8060481504601085, -0.7798041929843715, -0.04647785744085193, 0.1919606767141056, -2.664110795746724, 0.8078279831289855, -1.5299553625535927], 27.45128449755453);");
    con.Query("INSERT INTO t VALUES ([-0.14822242789963685, 0.08556098289481506, 1.1770131391590135, -1.9123993496678076, 0.10149709318552762, 1.4011956314899279, 0.8811072740581095, 0.9751915250341777, -0.4790586966109701], 35.97737868287539);");
    con.Query("INSERT INTO t VALUES ([-0.8078337270474312, 0.4379185012330211, -0.7032396318271465, 0.13437073957980272, 0.4612605064069735, 0.38752856156598875, -0.24686129024175218, 0.26197103623712037, -2.075218723085522], 16.03755928828662);");
    con.Query("INSERT INTO t VALUES ([0.6938674154973138, -0.024018403625294324, 1.4263080421941665, -1.570916657037526, -1.0767367021313263, 1.1916409660433194, 0.6237008669862828, -0.4269771845208572, 0.9672493734457598], 11.932082335847703);");
    con.Query("INSERT INTO t VALUES ([-0.8293032286354803, -0.5740625217372946, -0.44661644643835563, -0.09595898919536898, 0.0690627460974104, -0.4624416961733019, -0.10969779562249837, -0.7437487978623597, 0.8078078381323897], -2.957238675892679);");
    con.Query("INSERT INTO t VALUES ([-1.6655866093345597, -0.635269319204695, -0.7037218076473924, 0.9500166939928057, -0.43223211462554706, 1.280889125198327, -0.29592861458671843, -1.248481737932868, 1.003773578271299], -21.011718459578738);");
    con.Query("INSERT INTO t VALUES ([-0.5605055500962104, -0.3909854715795566, -0.9208297480151191, 0.05128248341907142, -0.6687681533489176, 0.8068046384868017, -0.6640412341236971, 0.43378542779603413, 0.6528022693630592], -4.300317516031148);");
    con.Query("INSERT INTO t VALUES ([-0.5422344168167292, 0.7498468273326891, 0.08355741756375645, -0.40736446039503377, -0.04067914636687521, -0.3822212081548184, -0.3618586519210731, 1.3065083122854415, -0.6897377535245522], 16.699645251893003);");
    con.Query("INSERT INTO t VALUES ([0.16332313835237097, -2.462161928092472, 0.2123817002791694, 0.7663982905422717, -2.2724771597861935, -1.5981970522656659, -1.3121028287100924, -0.27255423334200224, -0.45936654920906944], -13.98379616298551);");
    con.Query("INSERT INTO t VALUES ([1.5768900376288906, 0.677932915366516, -0.23922268261937413, -1.715173630229736, -0.5122079443941125, 0.22589270648232818, -0.7813639036489396, -0.24391422225031428, 0.31721497652107855], 15.949677806592383);");
    con.Query("INSERT INTO t VALUES ([0.1184804395742157, -0.15372064070029567, -0.4484942933070281, 0.23017315324089857, -1.4411699441964512, -0.034596612229730435, 0.42969382700609343, -0.418918643723051, 0.7569931102439258], -14.857164678864738);");
    con.Query("INSERT INTO t VALUES ([0.28314009841281856, 0.8625452819943298, -1.2166427007821978, 0.2480829869637103, -0.1267975593875059, -0.5643320226988093, -0.03786670941848727, -0.4759975416539943, 0.37508291766996404], -6.6878173213948315);");
    con.Query("INSERT INTO t VALUES ([-1.3709931189658622, 0.5391442918346454, 1.4617253693690049, 0.12601579979268687, 0.46931679200297255, 0.8747642219096609, -0.18403812834493843, 0.7712184925397321, 0.8130279161270159], 11.537075370567642);");
    con.Query("INSERT INTO t VALUES ([1.5521823317602204, 0.27363604025751526, -0.9132825734610388, -0.21077282238285566, -1.0605923074632377, 0.8048139368473655, -1.091800178457341, 0.6467909751385718, -1.0538412371377792], 8.9049714310443);");
    con.Query("INSERT INTO t VALUES ([-1.9055196040855393, 0.2988744553353596, -0.6178521536404745, -0.1761281064702754, 0.2913105424017272, 1.7629215549836348, 0.718130495834775, -1.359468740010663, 0.962980465987645], -7.604221079119391);");
    con.Query("INSERT INTO t VALUES ([-1.085623123196433, 1.0020180752350145, 0.3077624631135131, -0.21887184276204588, -2.0694961283324154, -0.7284447709955317, 1.7403845865952334, 1.6401453318305301, -1.9266500757465557], 3.201186186389254);");
    con.Query("INSERT INTO t VALUES ([1.4570356552913768, 1.1746613111183037, 0.07728041705881109, 1.202909701693079, 0.26790158577677575, -1.2567063134094705, 0.5948662542812652, 1.1990908957669268, -0.6805810446434087], 10.260396058961325);");
    con.Query("SELECT linear_regression(features, label, 0) AS linear_regression FROM t")->Print();

    // MUNGO TODO: Linear regression ring tests

    std::cout << "<========== QuackML tests complete ==========>\n";
}


void QuackmlExtension::Load(DuckDB &db) {
	Connection con(db);
    con.BeginTransaction();
    auto &catalog = Catalog::GetSystemCatalog(*con.context);

    quackml::Sum::RegisterFunction(con, catalog);
    quackml::SumCount::RegisterFunction(con, catalog);
    quackml::LinearRegression::RegisterFunction(con, catalog);
    quackml::ToRing::RegisterFunction(con, catalog);
    quackml::LinearRegressionRing::RegisterFunction(con, catalog);

    con.Commit();

    #ifdef QUACKML_TESTS
        run_quackml_tests(db);
    #endif
}

std::string QuackmlExtension::Name() {
	return "QuackML";
}

} // namespace duckdb

extern "C" {

DUCKDB_EXTENSION_API void quackml_init(duckdb::DatabaseInstance &db) {
    duckdb::DuckDB db_wrapper(db);
    db_wrapper.LoadExtension<duckdb::QuackmlExtension>();
}

DUCKDB_EXTENSION_API const char *quackml_version() {
	return duckdb::DuckDB::LibraryVersion();
}
}

#ifndef DUCKDB_EXTENSION_MAIN
#error DUCKDB_EXTENSION_MAIN not defined
#endif
